<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Virtualization on Me &amp; Web</title>
    <link>http://unixera.com/categories/virtualization/</link>
    <description>Recent content in Virtualization on Me &amp; Web</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <managingEditor>frostwong@gmail.com (Frost Wong)</managingEditor>
    <webMaster>frostwong@gmail.com (Frost Wong)</webMaster>
    <copyright>(c) 2013-2016 Frost Wong. All rights reserved.</copyright>
    <lastBuildDate>Thu, 13 Oct 2016 16:35:22 +0800</lastBuildDate>
    <atom:link href="http://unixera.com/categories/virtualization/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>使用VboxManage创建虚拟机</title>
      <link>http://unixera.com/virtualization/create-a-virtual-machine-with-vboxmanage/</link>
      <pubDate>Thu, 13 Oct 2016 16:35:22 +0800</pubDate>
      <author>frostwong@gmail.com (Frost Wong)</author>
      <guid>http://unixera.com/virtualization/create-a-virtual-machine-with-vboxmanage/</guid>
      <description>

&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;

&lt;p&gt;最近没有产品需求，就深入的研究一下大数据吧，第一步先要搭建一个集群，前面已经写了一篇关于搭建“伪集群”的文章，还是希望更完整的理解这套东西，还是弄一套真正的集群吧。但是没有机器，就只能拿本地的台式机搞起来了。&lt;/p&gt;

&lt;p&gt;本文主要介绍了如何使用VirtualBox命令行工具VboxManage创建和维护虚拟机。官方文档中说到VBoxManage的功能是比GUI的VirtualBox要更完整的，但其实我也用不到那么完整的功能，我能想到的主要有以下几点，参照官方文档来逐个完成。&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;创建一个虚拟机&lt;/li&gt;
&lt;li&gt;给虚拟机配置网络、CPU核心、内存、磁盘驱动器&lt;/li&gt;
&lt;li&gt;复制（clone）虚拟机&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;我使用的环境如下：
&lt;img src=&#34;http://7xn2pe.com1.z0.glb.clouddn.com/machine.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;下面开搞吧。&lt;/p&gt;

&lt;h2 id=&#34;创建虚拟机&#34;&gt;创建虚拟机&lt;/h2&gt;

&lt;h3 id=&#34;知识&#34;&gt;知识&lt;/h3&gt;

&lt;h4 id=&#34;1-vboxmanage-createmedium&#34;&gt;1. &lt;code&gt;VBoxManage createmedium&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;首先要创建一块磁盘。&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;--name &amp;lt;name&amp;gt;&lt;/code&gt; 创建的设备的名字&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--format VDI|VMDK|VHD&lt;/code&gt; 创建的设备的格式，默认是vdi，当年我做云主机运维的时候还测试过各种虚拟化磁盘格式的性能，vdi的性能是所有可选项里面最快的，值得信赖&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--size &amp;lt;megabytes&amp;gt;&lt;/code&gt; 创建的磁盘的大小，以M为单位&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;注意这个命令创建的磁盘是位于你当前所在的目录的，所以为了避免后面的问题，你最好在你想放在的位置执行这个命令。&lt;/p&gt;

&lt;h4 id=&#34;2-vboxmanage-createvm&#34;&gt;2. &lt;code&gt;VBoxManage createvm&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;然后创建一个虚拟机。&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;--name &amp;lt;name&amp;gt;&lt;/code&gt; 指定虚拟机的名字，还会在&lt;code&gt;~/.config/VirtualBox/Machines&lt;/code&gt;目录下创建同名的xml文件，如果该虚拟机被重命名，该xml文件也会被自动重命名。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--basefolder &amp;lt;path&amp;gt;&lt;/code&gt; 指定上述的Machines目录，如果指定了这个目录，新创建时还是会在这个目录下产生xml文件，但当虚拟机被重命名时，该xml不会被重命名。所以这里我觉得还是不要改为好，虽然通常也不会去重命名虚拟机。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--groups &amp;lt;group&amp;gt;&lt;/code&gt; 指定虚拟机组，总是从&lt;code&gt;/&lt;/code&gt;开始，可以嵌套，默认是&lt;code&gt;/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--ostype &amp;lt;ostype&amp;gt;&lt;/code&gt; 指定虚拟机的操作系统类型，具体支持的操作系统类型可以使用&lt;code&gt;VBoxManage list ostypes&lt;/code&gt;来查看。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--uuid &amp;lt;uuid&amp;gt;&lt;/code&gt; 指定虚拟机的UUID，这个id在宿主机的命名空间内必须是唯一的，如果指定了虚拟机组，则在组内必须是唯一的，如果不指定，会自动生成，所以这个其实也每必要指定。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;默认情况下，这个命令只会创建一个xml文件，而并不会把虚拟机注册到系统中，可以使用&lt;code&gt;--register&lt;/code&gt;选项或者单独执行&lt;code&gt;VBoxManage register &amp;lt;uuid&amp;gt;&lt;/code&gt;来执行注册。&lt;/p&gt;

&lt;h4 id=&#34;3-vboxmanage-storagectl&#34;&gt;3. &lt;code&gt;VBoxManage storagectl&lt;/code&gt;&lt;/h4&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;uuid|vmname&amp;gt;&lt;/code&gt; 指定要操作的虚拟机，可以使用前面创建时指定的名字，或者自动生成的uuid&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--name &amp;lt;name&amp;gt;&lt;/code&gt; 要创建的控制器的名字&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--controller&lt;/code&gt; 控制器，这个我也不太懂，一般电脑上是ACHI，这里就选IntelAHCI吧&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--add&lt;/code&gt; 添加的控制器类型，因为我们要创建的是磁盘驱动器，所以选择sata&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
&lt;p&gt;这里其实是瞎说的，我也不太懂电脑硬件，这些概念不了解，就照着熟悉的来吧。需要创建两种类型的设备控制器，一个是磁盘控制器，用来管理硬盘，一个是光驱，用来管理ISO文件。这个很容易理解，这一步是创建控制器，而而这控制的东西，磁盘是前面创建的，iso是先前下载好的。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;4-vboxmanage-storageattach&#34;&gt;4. &lt;code&gt;VBoxManage storageattach&lt;/code&gt;&lt;/h4&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;uuid|vmname&amp;gt;&lt;/code&gt; 指定要操作的虚拟机，可以使用前面创建时指定的名字，或者自动生成的uuid&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--storagectl &amp;lt;name&amp;gt;&lt;/code&gt; 这就是上面那个&lt;code&gt;storagectl&lt;/code&gt;命令时的&lt;code&gt;--name&lt;/code&gt;选项指定的参数了&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--port&lt;/code&gt; 端口号&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--device&lt;/code&gt; 设备号&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--type&lt;/code&gt; 设备类型&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--medium&lt;/code&gt; 指定创建磁盘文件，即vdi文件&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;把创建的磁盘驱动器和虚拟机、磁盘连接起来。&lt;/p&gt;

&lt;h4 id=&#34;5-vboxmanage-list-hdds&#34;&gt;5. &lt;code&gt;VBoxManage list hdds&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;这时就可以查看注册过的磁盘了。&lt;/p&gt;

&lt;h3 id=&#34;操作&#34;&gt;操作&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;// 创建磁盘
$ vboxmanage createmedium disk --filename CentOS7.vdi --size 50000
0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%
Medium created. UUID: 1cc3b870-7180-4eea-8263-f82a783d1478

// 创建虚拟机配置
$ cd ~/cluster
$ vboxmanage createvm --name CentOS7 --ostype RedHat_64 --register
Virtual machine &#39;CentOS7&#39; is created and registered.
UUID: 4afd6d6d-9cee-4efe-89a6-b752644711f0
Settings file: &#39;/home/hadoop/VirtualBox VMs/CentOS7/CentOS7.vbox&#39;

// 创建磁盘控制器
$ vboxmanage storagectl 4afd6d6d-9cee-4efe-89a6-b752644711f0 --add sata --controller IntelAHCI --name &amp;quot;SATA Controller&amp;quot;

// 绑定磁盘控制器
$ vboxmanage storageattach 4afd6d6d-9cee-4efe-89a6-b752644711f0 --storagectl &amp;quot;SATA Controller&amp;quot; --port 0 --device 0 --type hdd --medium CentOS7.vdi

// 创建光盘驱动器
$ vboxmanage storagectl 4afd6d6d-9cee-4efe-89a6-b752644711f0 --name &amp;quot;IDE Controller&amp;quot; --add ide

// 绑定光盘控制器
$ vboxmanage storageattach 4afd6d6d-9cee-4efe-89a6-b752644711f0 --storagectl &amp;quot;IDE Controller&amp;quot; --port 0 --device 0 --type dvddrive --medium ~/Downloads/CentOS-7-x86_64-Minimal-1511.iso

// 设置网络连接方式为桥接
$ vboxmanage modifyvm 4afd6d6d-9cee-4efe-89a6-b752644711f0 --nic1 bridged --bridgeadapter1 eno1


&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;注意：在我的操作系统下，执行createvm会在~/VirtualBox VMs/目录下生成&lt;code&gt;CentOS7.vbox&lt;/code&gt;文件，其实就是一个xml文件。而所谓的注册操作，就是在&lt;code&gt;~/.config/VirtualBox&lt;/code&gt;目录下生成一个VirtualBox.xml文件，里面有注册过的虚拟机的信息，类似下图所示：
&lt;img src=&#34;http://7xn2pe.com1.z0.glb.clouddn.com/virtualbox.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;复制虚拟机&#34;&gt;复制虚拟机&lt;/h2&gt;
</description>
    </item>
    
  </channel>
</rss>
