<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.16" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel='stylesheet' href='//fonts.proxy.ustclug.org/css?family=Open+Sans|Marcellus+SC'>
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.7.0/styles/github.min.css">
    <link rel="stylesheet" href="http://unixera.com/css/styles.css">
    <link rel="stylesheet" href="http://unixera.com/css/custom.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://unixera.com//index.xml">

    
    <title>Php - Me &amp; Web</title>
    <meta property='og:title' content="Php - Me &amp; Web">
    <meta property="og:type" content="article">
    

    <meta property="og:url" content="http://unixera.com/categories/php/">
    
    

  </head>

  <body>

    <header class="site">
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://unixera.com/">Me &amp; Web&nbsp;&nbsp;致力于创作可操作性更好的文章</a>
          </div>

          <div id="navbar" class="collapse navbar-collapse">
            
            <ul class="nav navbar-nav navbar-right">
              
              
              <li><a href="http://unixera.com/">首页</a></li>
              
              
              
              <li><a href="http://unixera.com/about">关于作者</a></li>
              
              
              
              <li><a href="http://unixera.com/categories/">分类</a></li>
              
              
              
              <li><a href="http://unixera.com/tags/">标签</a></li>
              
              
            </ul>
            
          </div>

        </div>
      </nav>
    </header>

    <div class="site">
      <div class="container">


<div class="list">

  <div class="row">
    <div class="col-md-8">
      <header class="page-title">Php</header>

      
      <article class="li">
  <header>
    <div class="date">Tue, Apr 5, 2016</div>
    <div class="title"><a href="http://unixera.com/php/php-generator-and-iterator/">使用PHP生成器和迭代器</a></div>
  </header>
  <div class="body">从开始写PHP就知道迭代器这个东西，当时师傅告诉我用的挺少的，需要的时候再看也不晚，于是就没有放在意上。但他还说这其实也是区分高手和菜鸟的一</div>

  
  <footer>
    <a href="http://unixera.com/php/php-generator-and-iterator/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Fri, Apr 1, 2016</div>
    <div class="title"><a href="http://unixera.com/php/log-bench/">seaslog 和 error_log性能大比拼</a></div>
  </header>
  <div class="body">今天花了点时间测试了开源项目seaslog和PHP内置的error_log的性能。本文不涉及该扩展的安装和使用，如果对其不了解，可移步官网。 项目的描述有语法问题&rdquo;A effective &hellip;&ldquo;，我提醒了原作者，然而并没有被理会。。。 测试环境 项目 属性 CPU Intel&reg; Xeon&reg; CPU E5520 @ 2.27GHz 8核 内存 48G PHP 7.0.1 Nginx 1.2.7 测试代码 &lt;?php error_log(&quot;I am testing performance of error_log&quot; . PHP_EOL, 3, __DIR__ . '/error_log.log'); SeasLog::debug(&quot;I am testing performance of seaslog&quot;); 结果数据 每种方式测试5次，请求次数1000次，并发量分别是1, 10, 100, 1000。分别记录每次测试的QPS。 1. error_log 并发量 1 2 3 4 5 1 2430 2579 2685 2484 2622 10 7303 7844 5892 11739 9002 100 11763 6107 6921 9258 11999 1000 324 891 324 889 883 2.</div>

  
  <footer>
    <a href="http://unixera.com/php/log-bench/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Mon, Feb 1, 2016</div>
    <div class="title"><a href="http://unixera.com/php/Yaf-yet-another-manual-for-human/">又一份Yaf文档——写给正在迷惑的你</a></div>
  </header>
  <div class="body">终于把困扰我很久的问题搞定了，好开心。趁着记忆还热乎，一定要把它记下来。 前几天还和同事抱怨，用Yaf框架的人那么多，但我们身边竟然没有一个人对它的用法很清楚的。真是有些悲哀。几个同事都说鸟哥写的Yaf文档看不明白。 言归正传，就我自己的学习过程来看，如果你要自己搭建一个Yaf环境，遇到的问题可能主要有以下这些： 配置Nginx的rewrite规则 命名空间怎么用 目录结构设置 插件的使用 单Controller多Action配置 多模块配置 更多配置文件 下面就这些问题一一给出解答。 配置Nginx的rewrite规则 让我们直接忽略Apache和Lighttpd吧，默认大家都用Nginx。 Yaf路由规则 如果你看过官方文档，那4种路由规则我就不说了，只说最简单也是默认的Yaf_Route_Static。 读了Yaf源码的同学会发现，其实这个规则就是解析request_uri，用/把它分开，然后用每一部分去匹配Module/Controller/Action/Param。举个例子吧，假设PATH=/foo/bar/doge，更通俗一点，如果你的域名是http://yaf.dev，那么这个例子中的完整URL就是http://yaf.dev/foo/bar/doge。 路由规则做了以下动作： 解析URL，得到PATH部分 认为foo是Module，去application.modules配置中找Foo（不区分大小写） 如果找到了modules/Foo，则继续认为bar是Controller，查找modules/Foo/BarController；没找到则会认为foo是Controller，下面同4 如果找到了modules/Foo/BarController，则继续认为doge是Action，查找modules/Foo/BarController/dogeAction 这样是不是很清晰了？ 不要这样配 老湿老湿，你不是要说Nginx的rewrite规则怎么配吗，怎么在这讲起了路由规则？ 我是要告诉你不要听那些自作聪明的人(没错就是我)把rewrite规则配错!!! 也就是说 rewrite ^/(.*) /index.php/$1 last; 是绝对正确的，不要看谁谁谁说这不对而写成 rewrite ^/(.*) /index.php?$1 last; 这才是错误的。 我的配置: server { listen 80; root /var/www/yaf.ubuntu.com/public; index index.php index.html; server_name yaf.ubuntu.com; location = /favicon.ico { access_log off; error_log off; log_not_found off; } if (!-e $request_filename) { rewrite ^/(.*\.(js|ico|gif|jpg|png|css|bmp|html|xls)$) /public/$1 last; rewrite ^/(.*) /index.php/$1 last; } location ~ \.php { include snippets/fastcgi-php.conf; fastcgi_pass unix:/usr/local/var/run/php-fpm-www.sock; } } 上面这个配置主要是加上了对静态文件的支持，如果没有多出来的配置，你会经常在日志中看到找不到Favicon.ico.php找不到的500报错。 FPM配置 那好，路由规则明白了，rewrite规则好了，毕竟我是PHP脚本啊，得有FPM吧。通常来说，Nginx会给你一个默认的配置，以Debian为例，用apt安装的Nginx自带的default配置location ~ \.php$段如下（已删除注释，我喜欢用unix socket，不服来打我啊） location ~ \.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/var/run/php7.0-fpm.sock; } 这样没问题，但也仅限于http://yaf.dev/xxxx.php这种请求。别的都匹配不到啊，别忘了，你请求URL可不是这样的。 所以，只要它是个请求，都要让它可以经过FPM。改成这样 location / { include snippets/fastcgi-php.conf; fastcgi_pass unix:/var/run/php7.0-fpm.sock; } 好了，把这两部分保存一下，重启一下Nginx服务sudo systemctl restart nginx，访问一下，哈，爽。 静态文件怎么办？ 这样配置，访问Action什么的是没问题了，但如果要访问这个域名下的静态文件，css/js啥的，就有问题了，这就需要在上面的location /段前面再添加一些匹配到这些静态文件的段，让它找到对应的文件。这里就不再赘述。 命名空间怎么办？ 配置 新时代的我们当然想用命名空间了，起码我是不想写那么长的类名。 可喜的是Yaf只需要一条配置就可以爽快的支持PSR-4规范的命名空间。 可惜的是Yaf的这条配置是全局的，如果你的应用和别的应用公用PHP配置，而别人不用，那就没办法了。 这条配置就是 ;php.ini yaf.use_namespace=1 举例 我们都需要Http类吧，假设我写个HttpFoundation\Request类，可以在library下新建HttpFoundation目录，在其中新建Request.php。 // HttpFoundation/Request.php namespace HttpFoundation; class Request { public function get() { echo &quot;I am going to send a GET request&quot;; exit; } } 这样就注册了一个HttpFoundation\Request类，在Controller中使用它只需要这样 use Yaf\Controller_Abstract; use HttpFoundation\Request; class FooController extends Controller_Abstract { public function barAction() { $request = new Request(); $request-&gt;get(); exit; } } 再远一点？ 是不是感受到了鸟哥的高瞻远瞩？其实我们还可以想的更多一点，既然可以自己写个HttpFoundation包了，你有没有想到Composer？因为多数时候这些基础类库都有现成的，用Composer安装就好，既然Yaf已经提供了性能好于autoloader的Yaf_Loader，何乐而不用呢？你甚至都可以引入第三方的ORM，比如Doctrine，第三方模板引擎Twig——对，没错，我就是Symfony的粉丝。 目录结构设置 读一下Yaf源代码就特别清晰的看到默认的目录设置了。 ├── application │ ├── Bootstrap.php │ ├── controllers │ │ ├── Another.php │ │ └── Index.php │ ├── library │ │ ├── Helper │ │ └── HttpFoundation │ │ └── Request.php │ ├── models │ ├── modules │ │ └── Foo │ │ └── controllers │ │ └── Foo.php │ ├── plugins │ └── views ├── conf │ ├── app.ini │ └── db.ini └── public └── index.php application 这是应用的主目录。 想让应用能最简单的跑起来，得有Controller，也就是controllers目录，这里面放的是IndexModule的东西。 底层用到的一些类库，放在library里。 数据库操作放在models里。 多模块放在modules里。像上面的树图里一样，每个module里还有相应的Controller。 conf 存放配置文件。 我看多数时候是把它放在application里的，但我更倾向于把它放在和application同级目录下。其中的app.ini是Yaf框架的基础配置，里面需要包含Yaf的『唯一一个』必选配置项application.directory。 public 存放index.php和静态文件。 这里是用户可以直接访问的文件。静态文件放在这里最合适不过了。 插件的使用 应用上线后Nginx的配置就不太好改了，但我们可以随意修改代码啊，所以如果需要对路由规则做一些修改，可以写个插件。下面以Route插件为例，介绍插件的使用。 新建插件 在application/plugins目录里新建Route.php。 use Yaf\Plugin_Abstract; use Yaf\Request_Abstract; use Yaf\Response_Abstract; class RoutePlugin extends Plugin_Abstract { public function routerStartup(Request_Abstract $request, Response_Abstract $response) { // some logic here $request-&gt;setModule('foo'); $request-&gt;setController('bar'); $request-&gt;setAction('doge'); } ....</div>

  
  <footer>
    <a href="http://unixera.com/php/Yaf-yet-another-manual-for-human/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Sat, Jan 9, 2016</div>
    <div class="title"><a href="http://unixera.com/php/2016-01-14-create-a-composer-package/">创建一个PSR-4规范的composer包</a></div>
  </header>
  <div class="body">下载安装Composer 到composer官网按照指示下载。官方建议的是用curl -sS https://getcomposer.org/installer | php这条命令。可能有些同学会迷惑这是在干什么，这其实是为了保证你下载到的总是最新的composer。分析一下，首先看到了管道，把前面curl获取的结果交给php执行，执行的结果就是下载了一个最新的composer.phar到当前目录下。这时虽然也可以说已经能用了，但通常我还会把它链接到/usr/local/bin目录下，方便使用。 sudo ln -s /home/frost/packages/composer.phar /usr/local/bin/composer 这时在终端输入composer就应该能看到它的帮助信息了。 配置Packagist 原本这不是必需的，但由于众所周知的原因，我还是建议配置一下。具体见这里。 composer config -g repositories.packagist composer http://packagist.phpcomposer.com就可以了。 composer.json 简单起见，这里使用monolog/monolog为例。 要使用composer，首先需要一个composer.json文件，它描述了项目依赖关系及其他一些元信息。 require关键字 require可能是你第一个也是唯一需要制定的东西。它用来告诉Composer你的项目需要依赖哪些包。 { &quot;require&quot;: { &quot;monolog/monolog&quot;: &quot;1.0.*&quot; } } 如你所见，require接受一个包含包名(monolog/monolog)和版本限制(1.0.*)的映射的对象。 包名 包名由vendor名和项目名组成。两者经常会是相同的——vendor名的存在只是为了避免名称冲突。它可以允许两个人创建同一个名称的库json，这样两个包名就可能是igorw/json和seldaek/json了。 这里我们“需要”monolog/monolog，所以vendor名和项目名一样。建议对项目使用唯一的名字。稍后还允许同一个命名空间下的多个项目。如果你在维护一个库，这可以让你很容易的把它分成多个解耦的小部分。 包版本 上面的例子中我们“需要”版本1.0.*，这表示1.0版本的所有分支。 版本限制可以用多种不同的方式，这里给出了详细的解释。 稳定性 默认情况下只考虑稳定版本。如果你也希望用RC, beta, alpha或者开发版，可以用稳定性标识。为了不用为每个包单独设置稳定性标识，还可以用最小稳定性 安装依赖 要安装依赖，只需要执行composer install即可。 这会找到符合版本限制的最新版本的monolog/monolog，并且把它下载到vendor目录。把第三方的代码放在一个名为vendor的目录是一个规范。在本例中，会把它放在vendor/monolog/monolog。 如果你使用git，通常会把vendor目录放在.gitignore中。 你会注意到composer install命令还会在当前目录下生成一个composer.lock文件。 composer.lock锁文件 安装完依赖后，Composer会把它安装的精确版本号写入composer.lock文件中。它把项目锁定在某个特定的版本号。 把composer.lock文件和composer.json一起提交到版本控制中。这很重要，因为install命令会检查锁文件是否存在，如果存在，它就会下载指定的精确版本，否则就会按照composer.json的描述下载符合约束的最新版本。 这意味着每个下载了你的项目的人看到的都是完全相同的代码，不会因为依赖更新了就自动更新依赖。update命令会将依赖更新到符合要求的最新版本，然后更新锁文件。 update命令也可以指定单独的包名来更新指定的包。 Packagist Packagist是Composer的信息库。一个Composer信息库本质上是一个包的源——从这里你可以获取包。Packagist希望成为每个人用的中心信息库。这意味着你可以自动require任何这里存在的包。 自动加载 对于指定了自动加载信息的库，Composer会生成一个vendor/autoload.php文件。你可以放心的include这个文件而Composer会完成剩下的工作。 require __DIR__ . '/vendor/autoload.php'; 这让使用第三方代码很方便。比如，如果你的项目依赖Monolog，你可以马上开始使用它的类，它会被自动加载。 $log = new Monolog\Logger('name'); $log-&gt;pushHandler(new Monolog\Handler\StreamHandler('app.log', Monolog\Logger::WARNING)); $log-&gt;addWarning('FOO'); 你还可以把自己的代码添加到composer.json的autoload字段。 { &quot;autoload&quot;: { &quot;psr-4&quot;: {&quot;Acme\\&quot;: &quot;src/&quot;} } } Composer就会为Acme命名空间注册一个PSR-4的自动加载器。 这里你定义の一个命名空间到目录的映射。src目录会是你的项目的根目录，和vendor在同级目录。比如文件src/Foo.php包含Acme\Foo类。 在添加了autoload字段之后，需要重新运行dump-autoload来重新生成vendor/autoload.php文件。包含这个文件还会返回一个自动加载器的实例，你可以把返回值存储下来并且添加更多的命名空间。这在测试时会很有用。比如 $loader = require __DIR__ .</div>

  
  <footer>
    <a href="http://unixera.com/php/2016-01-14-create-a-composer-package/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Wed, Nov 25, 2015</div>
    <div class="title"><a href="http://unixera.com/php/2015-11-25-xhprof-usage/">xhprof方便的插入要检测的代码</a></div>
  </header>
  <div class="body">本文只是给自己搞的一个小封装做个入口。 一次给同事写的一个接口做重构，上线以后发现性能恶化严重，导致了线上的严重问题，我马上想到用xhprof</div>

  
  <footer>
    <a href="http://unixera.com/php/2015-11-25-xhprof-usage/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Sat, Sep 26, 2015</div>
    <div class="title"><a href="http://unixera.com/php/2015-09-26-PHP%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-02/">PHP单元测试-02</a></div>
  </header>
  <div class="body">上一篇中讲了PHP单元测试的一些简单概念，这里详细说一下会用到的各种assert*函数。官方文档按照字母顺序逐一讲述了这些方法，但我觉得那很不合适，至少应该大概按照类别来分类。 数组相关 assertArrayHasKey($expected_key, $actual_array) 如果$expected_key是$actual_array中元素的一个键值，则通过，否则不通过。也即 foreach ($actual_array as $k =&gt; $v) { if ($k === $expected_key) { // 测试通过 return true; } // 测试不通过 return false; } assertArraySubset($subset_array, $actual_array) 如果$subset_array是$actual_array的一个子数组，则通过，否则不通过。也即前者是后者的子集，这点很重要，其实由于在PHP中数组是作为HashTable存储的，所以是一般并不存在顺序的问题。因此这里只要求前者是后者的子集，而至于顺序则不要求。 assertCount($count, $array) 如果count($array) === $count)则通过。注意这里$count的类型必须是整数。 类属性相关 assertClassHasAttribute($attributeName, $className) 如果类名为$className的类拥有一个名为$attributeName的属性，则通过，否则不通过。值得注意的是，这个测试通过与否与属性的值是否设置没有关系，即使是只声明了名为$attributeName的属性，这个测试也是通过的，但实例化该类之后var_dump(new ClassAttr()-&gt;attr)的结果却是false。 assetClassHasStaticAttribute($staticAttributeName, $className) 这个自不必多说，和上面类似。只是用来判断静态属性。 对象关系 assertObjectHasAttribute($attributeName, $object) 如果对象$object拥有属性$attributeName，则通过。 包含关系 assertContains($needle, $haystack) 如果$haystack中包含$needle，则通过，否则不通过。这个包含可以是数组的包含，也可以是字符串的包含，注意，默认是区分大小写的，即assertContains('foo', 'FooBar')是不能通过测试的。但assertContains('foo', 'FooBar', '', true)则可以通过测试，也就是说第四个参数表示不区分大小写。至于第三个参数，其实是$message，也就是在测试不通过时报告 详细信息的，我个人理解和try/cache里面的Exception $e里面的getMessage()可能有点类似，没有深究。 assertContainsOnly($type, $array) 如果$array中只包含由$type指定的一种类型的变量，则通过，否则不通过。 assertContainsOnlyInstanceOf($className, $instance_array) 如果$instance_array中的所有元素都是名为$className的类的实例，则通过，否则不通过。 assertInstanceOf($className, $instance) 如果$instance是$className的实例，则通过。 相等相关 是非问题 assertTrue($actual) assertFalse($actual)</div>

  
  <footer>
    <a href="http://unixera.com/php/2015-09-26-PHP%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-02/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Tue, Sep 22, 2015</div>
    <div class="title"><a href="http://unixera.com/php/2015-09-22-PHP%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-01/">PHP单元测试-01</a></div>
  </header>
  <div class="body">我自认对这种比较系统的知识总是比较欠缺，所以还是花点时间补充上比较好。 这里说一下PHP的单元测试。 首先是搭建可以进行单元测试的环境，这里我首</div>

  
  <footer>
    <a href="http://unixera.com/php/2015-09-22-PHP%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-01/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Fri, Jun 26, 2015</div>
    <div class="title"><a href="http://unixera.com/php/2015-06-26-huan-cun-shi-yong-xiao-ji/">缓存使用小记</a></div>
  </header>
  <div class="body">在请求次数多的业务系统中，通常会加入缓存系统。这里用的较多的就是Memcached和Redis。我写这篇笔记不是要说这两个缓存的使用细节，而</div>

  
  <footer>
    <a href="http://unixera.com/php/2015-06-26-huan-cun-shi-yong-xiao-ji/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Fri, Jun 19, 2015</div>
    <div class="title"><a href="http://unixera.com/php/2015-06-19-phpshe-zhi-cookie/">PHP设置cookie</a></div>
  </header>
  <div class="body"><p>之前一直没有处理过cookie，刚才小小的看了一下，貌似很简单，大概记一下。</p>

<p>首先，客户端要向服务端发送一个请求，服务端接收到请求之后做一下身份校验什么的，然后就可以给客户端种cookie了。</p>

<pre><code class="language-php">setcookie(&quot;key&quot;, &quot;value&quot;, time()+expire);
</code></pre>

<p><code>expire</code>是cookie的过期时间，上面的例子用了两部分来说明它，time()获取当前的时间戳，那么<code>expire</code>就是你希望这个cookie在当前时刻之后再存活的时间长短。</p>

<p>那么如何手动删除cookie呢？答案是无法直接删除cookie。但可以设置其过期，这样就间接的把它删除了。那怎样设置过期呢？<code>setcookie</code>的第三个参数设置的小于当前时间就可以了。</p>

<p>那怎么用cookie呢？</p>

<p>当你把cookie种到了客户端的机器上，它会保存在默认的域下，当客户端访问这个域下的资源时，发送的请求中会带着所有的cookie，然后在服务端用超全局变量<code>$_COOKIE['key']</code>就可以直接访问它了。</p>

<p>demo代码如下：</p>

<pre><code class="language-php">&lt;?php
$username = $_GET['username'];
$passwd = $_GET['passwd'];

if (/* 身份校验成功 */) {
    setcookie(&quot;username&quot;, $username, time() + 3600);
    echo &quot;cookie set&quot;;
}
</code></pre>

<pre><code class="language-php">&lt;?php
$username = $_COOKIE[&quot;username&quot;];
echo &quot;username: &quot; . $username;
</code></pre>
</div>

  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Wed, Jun 17, 2015</div>
    <div class="title"><a href="http://unixera.com/php/2015-06-17-phpyan-chi-bang-ding/">PHP延迟绑定</a></div>
  </header>
  <div class="body"><p>在公司的代码里看到很多重复代码，每张表对应的类都有一个一样的静态方法，作用是获得数据库的连接。但显然这并不是一个好的解决方案，而应该充分利用面向对象的思想，利用继承的方式来更优雅的解决。</p>

<p>我想，当初作者在写这部分代码的时候可能也已经考虑到了这个问题，但很可能是对PHP的延后绑定（LSB）不了解，因此没有实施。</p>

<p>得到数据库连接的实例有多种方式，这里我们假设有一个方法<code>DB::mysqlConn($tableName);</code></p>

<p>举个例子来说，假设我们设计一个基类<code>BaseConn</code>：</p>

<pre><code class="language-php">class BaseConn
{
    protected static $conn;
    protected static $tableName;
    
    public function getInstance()
    {
        self::$conn = DB::mysqlConn($tableName);
        return self::$conn;
    }
}
</code></pre>

<p>按照计划，我们就可以写子类了：</p>

<pre><code class="language-php">class ATableConn extends BaseConn
{
    protected static $tableName = 'atable';
    
    public static findById($id)
    {
        $query = &quot;select * from &quot; . self::$tableName . &quot; where id = {$id}&quot;;
        return $this-&gt;getInstance()-&gt;exec($sql);
    }
}
</code></pre>

<p>这时一般都会认为没有什么问题了，因为我们已经在子类里设定了<code>$tableName</code>的值，这样在创建数据库连接的时候一定就是<code>atable</code>的连接了。</p>

<p>错！</p>

<p>因为用<code>self</code>关键字绑定到了编译时引用的属性或方法。<code>self</code>关键字指向的是父类，而且不会意识到子类，基本上，编译器会用所绑定的名称替换<code>self</code>关键字。</p>

<p>那么怎么解决呢？PHP5.3为一个本来就存在的关键字赋予了新的含义——<code>static</code>，它会在可能的最近时刻强迫PHP绑定到实现代码。<sup class="footnote-ref" id="fnref:static"><a rel="footnote" href="#fn:static">1</a></sup></p>

<p>因此，把上面代码中<code>getInstance</code>方法中的<code>self</code>替换成<code>static</code>就可以了。</p>

<p>这个特性也就可以实现ActiveRecord了，不过这就是另外一个话题了。</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:static"><a href="http://www.ibm.com/developerworks/cn/opensource/os-php-53static/">PHP V5.3 用延后静态绑定搞活面向对象编程</a>
 <a class="footnote-return" href="#fnref:static"><sup>[return]</sup></a></li>
</ol>
</div>
</div>

  
</article>
<hr>

      
      
<nav>
  <ul class="pager">

    
    <li class="disabled"><a href="#">Previous</a></li>
    

    
    <li><a href="http://unixera.com/categories/php/page/2">Next</a></li>
    

  </ul>
</nav>



    </div>
    <div class="col-md-4">
      
<aside class="site">

  <div class="panel panel-primary">
    <div class="panel-heading">
      <div class="panel-title">
        <span class="fa fa-clock-o"></span><h4>最近文章</h4>
      </div>
    
    </div>
    <div class="list-group">
      
      <div class="list-group-item">
      <i class="fa fa-file-o" aria-hidden="true"></i> <a href="http://unixera.com/java/deploy-pseudo-distributed-mode-hadoop/" >在本地单机部署Hadoop/Storm运行环境</a>
      </div>
      
      <div class="list-group-item">
      <i class="fa fa-file-o" aria-hidden="true"></i> <a href="http://unixera.com/java/use-slf4j-and-log4j-to-log-your-applications/" >slf4j配合log4j来给你的应用打log</a>
      </div>
      
      <div class="list-group-item">
      <i class="fa fa-file-o" aria-hidden="true"></i> <a href="http://unixera.com/java/create-and-run-java-application-with-maven/" >使用maven创建和运行Java应用</a>
      </div>
      
      <div class="list-group-item">
      <i class="fa fa-file-o" aria-hidden="true"></i> <a href="http://unixera.com/linux/deepin-linux-experience/" >DeepinLinux 体验报告</a>
      </div>
      
      <div class="list-group-item">
      <i class="fa fa-file-o" aria-hidden="true"></i> <a href="http://unixera.com/java/mvn-tutorial-for-novice/" >给Java新手看的mvn指南</a>
      </div>
      
      <div class="list-group-item">
      <i class="fa fa-file-o" aria-hidden="true"></i> <a href="http://unixera.com/mac/use-ssh-config-to-tune-your-productivity-up/" >使用ssh-config提升你的生产力</a>
      </div>
      
      <div class="list-group-item">
      <i class="fa fa-file-o" aria-hidden="true"></i> <a href="http://unixera.com/miscs/talk-about-transgene-foods/" >谈谈转基因食物</a>
      </div>
      
      <div class="list-group-item">
      <i class="fa fa-file-o" aria-hidden="true"></i> <a href="http://unixera.com/php/internals/create-skeleton-of-extension/" >PHP扩展实战——扩展的骨架</a>
      </div>
      
      <div class="list-group-item">
      <i class="fa fa-file-o" aria-hidden="true"></i> <a href="http://unixera.com/php/internals/class-prototype-in-php/" >PHP扩展实战——用PHP实现类的原型</a>
      </div>
      
      <div class="list-group-item">
      <i class="fa fa-file-o" aria-hidden="true"></i> <a href="http://unixera.com/php/internals/schedules/" >PHP扩展实战——目标和计划</a>
      </div>
      
    </div>
  </div>

  
    
      <div class="panel panel-success">
      <div class="panel-heading">
        <div class="panel-title">
        <i class="fa fa-bars" aria-hidden="true"></i><h4>Category</h4>
        </div>
      </div>
      <div class="list-group">
        
        <div class="list-group-item">
        <i class="fa fa-folder-o" aria-hidden="true"></i> <a href="http://unixera.com/Categories/javascript">Javascript</a>
        </div>
        
        <div class="list-group-item">
        <i class="fa fa-folder-o" aria-hidden="true"></i> <a href="http://unixera.com/Categories/php">Php</a>
        </div>
        
        <div class="list-group-item">
        <i class="fa fa-folder-o" aria-hidden="true"></i> <a href="http://unixera.com/Categories/miscs">Miscs</a>
        </div>
        
        <div class="list-group-item">
        <i class="fa fa-folder-o" aria-hidden="true"></i> <a href="http://unixera.com/Categories/mac">Mac</a>
        </div>
        
        <div class="list-group-item">
        <i class="fa fa-folder-o" aria-hidden="true"></i> <a href="http://unixera.com/Categories/linux">Linux</a>
        </div>
        
        <div class="list-group-item">
        <i class="fa fa-folder-o" aria-hidden="true"></i> <a href="http://unixera.com/Categories/java">Java</a>
        </div>
        
        <div class="list-group-item">
        <i class="fa fa-folder-o" aria-hidden="true"></i> <a href="http://unixera.com/Categories/blog">Blog</a>
        </div>
        
        <div class="list-group-item">
        <i class="fa fa-folder-o" aria-hidden="true"></i> <a href="http://unixera.com/Categories/git">Git</a>
        </div>
        
        <div class="list-group-item">
        <i class="fa fa-folder-o" aria-hidden="true"></i> <a href="http://unixera.com/Categories/python">Python</a>
        </div>
        
        <div class="list-group-item">
        <i class="fa fa-folder-o" aria-hidden="true"></i> <a href="http://unixera.com/Categories/ios">Ios</a>
        </div>
        
      </div>
    </div>
    
    
  
    
    
      <div class="panel panel-info">
      <div class="panel-heading">
        <div class="panel-title">
        <i class="fa fa-tags" aria-hidden="true"></i></i><h4>Tag</h4>
        </div>
      </div>
      <div class="list-group">
        
        <div class="list-group-item">
        <span aria-hidden="true">#</span><a href="http://unixera.com/Tags/miscs">miscs</a>
        </div>
        
        <div class="list-group-item">
        <span aria-hidden="true">#</span><a href="http://unixera.com/Tags/php">php</a>
        </div>
        
        <div class="list-group-item">
        <span aria-hidden="true">#</span><a href="http://unixera.com/Tags/linux">linux</a>
        </div>
        
        <div class="list-group-item">
        <span aria-hidden="true">#</span><a href="http://unixera.com/Tags/mac">mac</a>
        </div>
        
        <div class="list-group-item">
        <span aria-hidden="true">#</span><a href="http://unixera.com/Tags/javascript">javascript</a>
        </div>
        
        <div class="list-group-item">
        <span aria-hidden="true">#</span><a href="http://unixera.com/Tags/java">java</a>
        </div>
        
        <div class="list-group-item">
        <span aria-hidden="true">#</span><a href="http://unixera.com/Tags/%E6%89%A9%E5%B1%95">扩展</a>
        </div>
        
        <div class="list-group-item">
        <span aria-hidden="true">#</span><a href="http://unixera.com/Tags/git">git</a>
        </div>
        
        <div class="list-group-item">
        <span aria-hidden="true">#</span><a href="http://unixera.com/Tags/bootstrap">bootstrap</a>
        </div>
        
        <div class="list-group-item">
        <span aria-hidden="true">#</span><a href="http://unixera.com/Tags/ios">ios</a>
        </div>
        
      </div>
    </div>
    
  

</aside>


    </div>
  </div>

</div>
      </div>
    </div>

    <footer class="site">
      <div class="container">
        <p>(c) 2013-2016 Frost Wong. All rights reserved.</p>
        <p>Powered by <a href="http://gohugo.io" target="_blank" rel="nofollow">Hugo</a>, Theme <a href="https://github.com/lovelock/hugo_theme_tech" target="_blank" rel="nofollow">tech</a> designed by <a href="http://unixera.com" target="_blank" rel="nofollow">Frost Wong</a></p>
      </div>
    </footer>

    <script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
    <script src="//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.7.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    

  </body>
</html>

