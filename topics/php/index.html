<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.16" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel='stylesheet' href='//fonts.googleapis.com/css?family=Open+Sans|Marcellus+SC'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <link rel="stylesheet" href="http://unixera.com/css/styles.css">
    <link rel="stylesheet" href="http://unixera.com/css/custom.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://unixera.com//index.xml">

    
    <title>Php - Me &amp; Web</title>
    <meta property='og:title' content="Php - Me &amp; Web">
    <meta property="og:type" content="article">
    

    <meta property="og:url" content="http://unixera.com/topics/php/">
    
    

  </head>

  <body>

    <header class="site">
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://unixera.com/">Me &amp; Web</a>
          </div>

          <div id="navbar" class="collapse navbar-collapse">
            
            <ul class="nav navbar-nav navbar-right">
              
              
              <li><a href="http://unixera.com/">Home</a></li>
              
              
              
              <li><a href="http://unixera.com/categories/">Categories</a></li>
              
              
              
              <li><a href="http://unixera.com/tags/">Tags</a></li>
              
              
              
              <li><a href="http://unixera.com/about/">About</a></li>
              
              
            </ul>
            
          </div>

        </div>
      </nav>
    </header>

    <div class="site">
      <div class="container">


<div class="list">

  <div class="row">
    <div class="col-md-8">
      <header class="page-title">Php</header>

      
      <article class="li">
  <header>
    <div class="date">Sat, Apr 9, 2016</div>
    <div class="title"><a href="http://unixera.com/php/internals/create-skeleton-of-extension/">PHP扩展实战——扩展的骨架</a></div>
  </header>
  <div class="body">前面啰嗦了这么多读者都要没有兴趣了。从现在起要真正开始PHP扩展开发阶段了。 首先来生成扩展的骨架。所谓骨架就是一个扩展需要的基本文件了。 获取</div>

  
  <footer>
    <a href="http://unixera.com/php/internals/create-skeleton-of-extension/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Sat, Apr 9, 2016</div>
    <div class="title"><a href="http://unixera.com/php/internals/class-prototype-in-php/">PHP扩展实战——用PHP实现类的原型</a></div>
  </header>
  <div class="body">在编写之前先用PHP实现这个类的原型吧。 &lt;?php namespace Hylog; use \DateTime; class Hylog { const HYLOG_VERSION = &quot;0.1.0&quot;; const EMERGENCY = 'EMERGENCY'; const ALERT = 'ALERT'; const CRITICAL = 'CRITICAL'; const ERROR = 'ERROR'; const WARNING = 'WARNING'; const NOTICE = 'NOTICE'; const INFO = 'INFO'; const DEBUG = 'DEBUG'; private static $_instance; private $_basePath; private</div>

  
  <footer>
    <a href="http://unixera.com/php/internals/class-prototype-in-php/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Sat, Apr 9, 2016</div>
    <div class="title"><a href="http://unixera.com/php/internals/schedules/">PHP扩展实战——目标和计划</a></div>
  </header>
  <div class="body">好了，现在来整理一下我们要做的工作。 功能目标 既然是要做一个记日志的扩展，那当然就避免不了两个功能： 格式化日志流 将日志流推送到特定目标（通常是</div>

  
  <footer>
    <a href="http://unixera.com/php/internals/schedules/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Tue, Apr 5, 2016</div>
    <div class="title"><a href="http://unixera.com/php/php-generator-and-iterator/">使用PHP生成器和迭代器</a></div>
  </header>
  <div class="body">从开始写PHP就知道迭代器这个东西，当时师傅告诉我用的挺少的，需要的时候再看也不晚，于是就没有放在意上。但他还说这其实也是区分高手和菜鸟的一个标志，那我还是研究一下好了：） PHP程序员都知道我们最经常用的可能就是foreach这个大杀器了。得益于我们万能的数组，所以这个大杀器在多数场合都是可以直接用的，只要输入元素是数组类型即可——事实上并不是如此，foreach能遍历数组并不是因为它是数组，而是因为数组implements了Iterator接口。说白了就是只要告诉foreach遍历的规则，它就可以执行遍历，而和是否数组无关。 Iterator 解析 Iterator接口定义了5个方法，如果一个类要实现Iterator接口，当然就要实现这一套方法了。Iterator的原型如下 Interface Iterator { abstract public function current() : mixed; abstract public function key() : scalar; abstract public function next() : void; abstract public function rewind() : void; abstract public function valid() : boolean; } 我在方法后面按照PHP7的新语法加了个返回值类型，其实这样写是不对的，但可以表明意思啦：） 详细说一下这几个方法要做的事情。 current() 返回当前位置的值。 key() 返回当前位置的键。 next() 当前位置的键加1。 rewind() 键回到第一个位置。 valid() 返回当前的键是否是有意义的。如是否是false/NULL等。 实例 还是来具体写个例子理解一下吧。通常写这种例子的作者都会举一个类，它的一个属性是个数组，然后实现Iterator的5个方法，来让这个类可以使用foreach，这个例子没意思，因为数组本身就带current、key这些方法。让我来举一个pdo_mysql从数据库中取数据的例子吧。 从数据库取出一一个数组，数组中的元素是User类的实例，我们需要Users类的方法，它又要有一些方法。所以，就产生了这样的用法了。这个例子可能有些牵强，但起码描述了一个使用场景，比单纯的迭代一个类的类型为数组的属性要有意义。 代码地址 Generator 只有真正理解了Iterator才能再来谈Generator。 还是举例来说，前面已经说了一个比较复杂的例子，这里为了说明二者的区别，举个简单的例子。 假定有一个日志文件，1000000行吧，很大了？或许吧。现在我们要遍历这个文件，找到我们需要的东西。如果使用Iterator，可能需要这样 &lt;?php class LinesIterator implements Iterator { private $_fp; private $_currentLine; private</div>

  
  <footer>
    <a href="http://unixera.com/php/php-generator-and-iterator/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Mon, Apr 4, 2016</div>
    <div class="title"><a href="http://unixera.com/php/internals/introduction/">PHP扩展实战——背景介绍</a></div>
  </header>
  <div class="body">这段时间其实在看C语言，但看来看去也不知道学了这些知识用在哪里。作为一名PHP程序员，想要进阶，当然得懂PHP的运行原理。那么，编写扩展就成</div>

  
  <footer>
    <a href="http://unixera.com/php/internals/introduction/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Fri, Apr 1, 2016</div>
    <div class="title"><a href="http://unixera.com/php/log-bench/">seaslog 和 error_log性能大比拼</a></div>
  </header>
  <div class="body">今天花了点时间测试了开源项目seaslog和PHP内置的error_log的性能。本文不涉及该扩展的安装和使用，如果对其不了解，可移步官网。 项目的描述有语法问题&rdquo;A effective &hellip;&ldquo;，我提醒了原作者，然而并没有被理会。。。 测试环境 项目 属性 CPU Intel&reg; Xeon&reg; CPU E5520 @ 2.27GHz 8核 内存 48G PHP 7.0.1 Nginx 1.2.7 测试代码 &lt;?php error_log(&quot;I am testing performance of error_log&quot; . PHP_EOL, 3, __DIR__ . '/error_log.log'); SeasLog::debug(&quot;I am testing performance of seaslog&quot;); 结果数据 每种方式测试5次，请求次数1000次，并发量分别是1, 10, 100, 1000。分别记录每次测试的QPS。 1. error_log 并发量 1 2 3 4 5 1 2430 2579 2685 2484 2622 10 7303 7844 5892 11739 9002 100 11763 6107 6921 9258 11999 1000 324 891 324 889 883 2.</div>

  
  <footer>
    <a href="http://unixera.com/php/log-bench/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Mon, Feb 1, 2016</div>
    <div class="title"><a href="http://unixera.com/php/Yaf-yet-another-manual-for-human/">又一份Yaf文档——写给正在迷惑的你</a></div>
  </header>
  <div class="body">终于把困扰我很久的问题搞定了，好开心。趁着记忆还热乎，一定要把它记下来。 前几天还和同事抱怨，用Yaf框架的人那么多，但我们身边竟然没有一个人对它的用法很清楚的。真是有些悲哀。几个同事都说鸟哥写的Yaf文档看不明白。 言归正传，就我自己的学习过程来看，如果你要自己搭建一个Yaf环境，遇到的问题可能主要有以下这些： 配置Nginx的rewrite规则 命名空间怎么用 目录结构设置 插件的使用 单Controller多Action配置 多模块配置 更多配置文件 下面就这些问题一一给出解答。 配置Nginx的rewrite规则 让我们直接忽略Apache和Lighttpd吧，默认大家都用Nginx。 Yaf路由规则 如果你看过官方文档，那4种路由规则我就不说了，只说最简单也是默认的Yaf_Route_Static。 读了Yaf源码的同学会发现，其实这个规则就是解析request_uri，用/把它分开，然后用每一部分去匹配Module/Controller/Action/Param。举个例子吧，假设PATH=/foo/bar/doge，更通俗一点，如果你的域名是http://yaf.dev，那么这个例子中的完整URL就是http://yaf.dev/foo/bar/doge。 路由规则做了以下动作： 解析URL，得到PATH部分 认为foo是Module，去application.modules配置中找Foo（不区分大小写） 如果找到了modules/Foo，则继续认为bar是Controller，查找modules/Foo/BarController；没找到则会认为foo是Controller，下面同4 如果找到了modules/Foo/BarController，则继续认为doge是Action，查找modules/Foo/BarController/dogeAction 这样是不是很清晰了？ 不要这样配 老湿老湿，你不是要说Nginx的rewrite规则怎么配吗，怎么在这讲起了路由规则？ 我是要告诉你不要听那些自作聪明的人(没错就是我)把rewrite规则配错!!! 也就是说 rewrite ^/(.*) /index.php/$1 last; 是绝对正确的，不要看谁谁谁说这不对而写成 rewrite ^/(.*) /index.php?$1 last; 这才是错误的。 我的配置: server { listen 80; root /var/www/yaf.ubuntu.com/public; index index.php index.html; server_name yaf.ubuntu.com; location = /favicon.ico { access_log off; error_log off; log_not_found off; } if (!-e $request_filename) { rewrite ^/(.*\.(js|ico|gif|jpg|png|css|bmp|html|xls)$) /public/$1 last; rewrite ^/(.*) /index.php/$1 last; } location ~ \.php { include snippets/fastcgi-php.conf; fastcgi_pass unix:/usr/local/var/run/php-fpm-www.sock; } } 上面这个配置主要是加上了对静态文件的支持，如果没有多出来的配置，你会经常在日志中看到找不到Favicon.ico.php找不到的500报错。 FPM配置 那好，路由规则明白了，rewrite规则好了，毕竟我是PHP脚本啊，得有FPM吧。通常来说，Nginx会给你一个默认的配置，以Debian为例，用apt安装的Nginx自带的default配置location ~ \.php$段如下（已删除注释，我喜欢用unix socket，不服来打我啊） location ~ \.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/var/run/php7.0-fpm.sock; } 这样没问题，但也仅限于http://yaf.dev/xxxx.php这种请求。别的都匹配不到啊，别忘了，你请求URL可不是这样的。 所以，只要它是个请求，都要让它可以经过FPM。改成这样 location / { include snippets/fastcgi-php.conf; fastcgi_pass unix:/var/run/php7.0-fpm.sock; } 好了，把这两部分保存一下，重启一下Nginx服务sudo systemctl restart nginx，访问一下，哈，爽。 静态文件怎么办？ 这样配置，访问Action什么的是没问题了，但如果要访问这个域名下的静态文件，css/js啥的，就有问题了，这就需要在上面的location /段前面再添加一些匹配到这些静态文件的段，让它找到对应的文件。这里就不再赘述。 命名空间怎么办？ 配置 新时代的我们当然想用命名空间了，起码我是不想写那么长的类名。 可喜的是Yaf只需要一条配置就可以爽快的支持PSR-4规范的命名空间。 可惜的是Yaf的这条配置是全局的，如果你的应用和别的应用公用PHP配置，而别人不用，那就没办法了。 这条配置就是 ;php.ini yaf.use_namespace=1 举例 我们都需要Http类吧，假设我写个HttpFoundation\Request类，可以在library下新建HttpFoundation目录，在其中新建Request.php。 // HttpFoundation/Request.php namespace HttpFoundation; class Request { public function get() { echo &quot;I am going to send a GET request&quot;; exit; } } 这样就注册了一个HttpFoundation\Request类，在Controller中使用它只需要这样 use Yaf\Controller_Abstract; use HttpFoundation\Request; class FooController extends Controller_Abstract { public function barAction() { $request = new Request(); $request-&gt;get(); exit; } } 再远一点？ 是不是感受到了鸟哥的高瞻远瞩？其实我们还可以想的更多一点，既然可以自己写个HttpFoundation包了，你有没有想到Composer？因为多数时候这些基础类库都有现成的，用Composer安装就好，既然Yaf已经提供了性能好于autoloader的Yaf_Loader，何乐而不用呢？你甚至都可以引入第三方的ORM，比如Doctrine，第三方模板引擎Twig——对，没错，我就是Symfony的粉丝。 目录结构设置 读一下Yaf源代码就特别清晰的看到默认的目录设置了。 ├── application │ ├── Bootstrap.php │ ├── controllers │ │ ├── Another.php │ │ └── Index.php │ ├── library │ │ ├── Helper │ │ └── HttpFoundation │ │ └── Request.php │ ├── models │ ├── modules │ │ └── Foo │ │ └── controllers │ │ └── Foo.php │ ├── plugins │ └── views ├── conf │ ├── app.ini │ └── db.ini └── public └── index.php application 这是应用的主目录。 想让应用能最简单的跑起来，得有Controller，也就是controllers目录，这里面放的是IndexModule的东西。 底层用到的一些类库，放在library里。 数据库操作放在models里。 多模块放在modules里。像上面的树图里一样，每个module里还有相应的Controller。 conf 存放配置文件。 我看多数时候是把它放在application里的，但我更倾向于把它放在和application同级目录下。其中的app.ini是Yaf框架的基础配置，里面需要包含Yaf的『唯一一个』必选配置项application.directory。 public 存放index.php和静态文件。 这里是用户可以直接访问的文件。静态文件放在这里最合适不过了。 插件的使用 应用上线后Nginx的配置就不太好改了，但我们可以随意修改代码啊，所以如果需要对路由规则做一些修改，可以写个插件。下面以Route插件为例，介绍插件的使用。 新建插件 在application/plugins目录里新建Route.php。 use Yaf\Plugin_Abstract; use Yaf\Request_Abstract; use Yaf\Response_Abstract; class RoutePlugin extends Plugin_Abstract { public function routerStartup(Request_Abstract $request, Response_Abstract $response) { // some logic here $request-&gt;setModule('foo'); $request-&gt;setController('bar'); $request-&gt;setAction('doge'); } ....</div>

  
  <footer>
    <a href="http://unixera.com/php/Yaf-yet-another-manual-for-human/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Sat, Jan 9, 2016</div>
    <div class="title"><a href="http://unixera.com/php/2016-01-14-create-a-composer-package/">创建一个PSR-4规范的composer包</a></div>
  </header>
  <div class="body">下载安装Composer 到composer官网按照指示下载。官方建议的是用curl -sS https://getcomposer.org/installer | php这条命令。可能有些同学会迷惑这是在干什么，这其实是为了保证你下载到的总是最新的composer。分析一下，首先看到了管道，把前面curl获取的结果交给php执行，执行的结果就是下载了一个最新的composer.phar到当前目录下。这时虽然也可以说已经能用了，但通常我还会把它链接到/usr/local/bin目录下，方便使用。 sudo ln -s /home/frost/packages/composer.phar /usr/local/bin/composer 这时在终端输入composer就应该能看到它的帮助信息了。 配置Packagist 原本这不是必需的，但由于众所周知的原因，我还是建议配置一下。具体见这里。 composer config -g repositories.packagist composer http://packagist.phpcomposer.com就可以了。 composer.json 简单起见，这里使用monolog/monolog为例。 要使用composer，首先需要一个composer.json文件，它描述了项目依赖关系及其他一些元信息。 require关键字 require可能是你第一个也是唯一需要制定的东西。它用来告诉Composer你的项目需要依赖哪些包。 { &quot;require&quot;: { &quot;monolog/monolog&quot;: &quot;1.0.*&quot; } } 如你所见，require接受一个包含包名(monolog/monolog)和版本限制(1.0.*)的映射的对象。 包名 包名由vendor名和项目名组成。两者经常会是相同的——vendor名的存在只是为了避免名称冲突。它可以允许两个人创建同一个名称的库json，这样两个包名就可能是igorw/json和seldaek/json了。 这里我们“需要”monolog/monolog，所以vendor名和项目名一样。建议对项目使用唯一的名字。稍后还允许同一个命名空间下的多个项目。如果你在维护一个库，这可以让你很容易的把它分成多个解耦的小部分。 包版本 上面的例子中我们“需要”版本1.0.*，这表示1.0版本的所有分支。 版本限制可以用多种不同的方式，这里给出了详细的解释。 稳定性 默认情况下只考虑稳定版本。如果你也希望用RC, beta, alpha或者开发版，可以用稳定性标识。为了不用为每个包单独设置稳定性标识，还可以用最小稳定性 安装依赖 要安装依赖，只需要执行composer install即可。 这会找到符合版本限制的最新版本的monolog/monolog，并且把它下载到vendor目录。把第三方的代码放在一个名为vendor的目录是一个规范。在本例中，会把它放在vendor/monolog/monolog。 如果你使用git，通常会把vendor目录放在.gitignore中。 你会注意到composer install命令还会在当前目录下生成一个composer.lock文件。 composer.lock锁文件 安装完依赖后，Composer会把它安装的精确版本号写入composer.lock文件中。它把项目锁定在某个特定的版本号。 把composer.lock文件和composer.json一起提交到版本控制中。这很重要，因为install命令会检查锁文件是否存在，如果存在，它就会下载指定的精确版本，否则就会按照composer.json的描述下载符合约束的最新版本。 这意味着每个下载了你的项目的人看到的都是完全相同的代码，不会因为依赖更新了就自动更新依赖。update命令会将依赖更新到符合要求的最新版本，然后更新锁文件。 update命令也可以指定单独的包名来更新指定的包。 Packagist Packagist是Composer的信息库。一个Composer信息库本质上是一个包的源——从这里你可以获取包。Packagist希望成为每个人用的中心信息库。这意味着你可以自动require任何这里存在的包。 自动加载 对于指定了自动加载信息的库，Composer会生成一个vendor/autoload.php文件。你可以放心的include这个文件而Composer会完成剩下的工作。 require __DIR__ . '/vendor/autoload.php'; 这让使用第三方代码很方便。比如，如果你的项目依赖Monolog，你可以马上开始使用它的类，它会被自动加载。 $log = new Monolog\Logger('name'); $log-&gt;pushHandler(new Monolog\Handler\StreamHandler('app.log', Monolog\Logger::WARNING)); $log-&gt;addWarning('FOO'); 你还可以把自己的代码添加到composer.json的autoload字段。 { &quot;autoload&quot;: { &quot;psr-4&quot;: {&quot;Acme\\&quot;: &quot;src/&quot;} } } Composer就会为Acme命名空间注册一个PSR-4的自动加载器。 这里你定义の一个命名空间到目录的映射。src目录会是你的项目的根目录，和vendor在同级目录。比如文件src/Foo.php包含Acme\Foo类。 在添加了autoload字段之后，需要重新运行dump-autoload来重新生成vendor/autoload.php文件。包含这个文件还会返回一个自动加载器的实例，你可以把返回值存储下来并且添加更多的命名空间。这在测试时会很有用。比如 $loader = require __DIR__ .</div>

  
  <footer>
    <a href="http://unixera.com/php/2016-01-14-create-a-composer-package/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Sat, Jan 9, 2016</div>
    <div class="title"><a href="http://unixera.com/miscs/static-dynamic-strong-weak-types-of-language/">谈谈动/静态类型和强/弱类型</a></div>
  </header>
  <div class="body">作为一个PHP程序员，这个问题本来不应该是我考虑的。 我需要知道仅仅是如果我的程序需要接受一个integer作为输入，拿到输入后最好能intval($var)一下，保证输入的是integer。而让我感到不理解的是，为什么PHP的强制类型转换会做成(int)$var这种方式，按照正常人的理解，不管int/string是关键字还是函数，要么作为int $var，这样具有迷惑性，因为在别的语言里这都是用来声明变量的，要么int($var)，这都很容易理解，然而。。。 好了，想到这个问题是因为这两天算是深入的用了Python的一些功能，当然主要还是用来处理日志，当我发现当我将两个从dict中取出的值相加，然后和一个数字的值对比时，并没有出现我要的结果。于是就查了下Python的类型。原来Python是动态类型，同时是强类型。 我看到网上很多人对这个问题还挺迷惑。刚看了PHP对于类型的解释，其实很能说明问题。 PHP 在变量定义中不需要（或不支持）明确的类型定义；变量类型是根据使用该变量的上下文所决定的。也就是说，如果把一个 string 值赋给变量 $var，$var 就成了一个 string。如果又把一个integer 赋给 $var，那它就成了一个integer。 这，就是标准的动态类型了。相应的，var a = 20 :Int，声明了变量a=20，同时指定该变量的类型是Int，如果var a = '20': Int在编译时就会报错，没错这就是静态类型（这是Swift的语法）。有人可能就会拿这个举例说C也是静态类型——的确，我也会认为它是静态类型，因为它也需要指定类型才可以定义——然而，判断是否是静态类型的根据并不在此，而是像知乎@姚培森的答案中说的，是根据它是否所有程序都是well behaved。这个就太深了，我就不深究了，毕竟对C的研究也不深，说错了还不如不说。 那再来看看让我误解的Python，无疑，Python和PHP一样在定义变量时也是不需要指定的，但对PHP来说， $a = 1; $b = '2'; echo $a + $b; 这样的代码完全没有问题。但到了Python这里 a = 1 b = '2' print(a + b) # 没错，我选择Python3 结果呢: Trt recent call last): File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt; TypeError: unsupported operand type(s) for +: 'int' and 'str' 这就是强类型和弱类型的区别了。强类型不允许出现forbidden behaviors。 从这一点也就可以理解为什么Python的JIT很早前就做出来了，而前段时间鸟哥还在说之前尝试做过PHP的JIT，但发现难度太大，而现在的PHP7实际就是在为后面的JIT铺路呢。</div>

  
  <footer>
    <a href="http://unixera.com/miscs/static-dynamic-strong-weak-types-of-language/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Sat, Sep 26, 2015</div>
    <div class="title"><a href="http://unixera.com/php/2015-09-26-PHP%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-02/">PHP单元测试-02</a></div>
  </header>
  <div class="body">上一篇中讲了PHP单元测试的一些简单概念，这里详细说一下会用到的各种assert*函数。官方文档按照字母顺序逐一讲述了这些方法，但我觉得那很不合适，至少应该大概按照类别来分类。 数组相关 assertArrayHasKey($expected_key, $actual_array) 如果$expected_key是$actual_array中元素的一个键值，则通过，否则不通过。也即 foreach ($actual_array as $k =&gt; $v) { if ($k === $expected_key) { // 测试通过 return true; } // 测试不通过 return false; } assertArraySubset($subset_array, $actual_array) 如果$subset_array是$actual_array的一个子数组，则通过，否则不通过。也即前者是后者的子集，这点很重要，其实由于在PHP中数组是作为HashTable存储的，所以是一般并不存在顺序的问题。因此这里只要求前者是后者的子集，而至于顺序则不要求。 assertCount($count, $array) 如果count($array) === $count)则通过。注意这里$count的类型必须是整数。 类属性相关 assertClassHasAttribute($attributeName, $className) 如果类名为$className的类拥有一个名为$attributeName的属性，则通过，否则不通过。值得注意的是，这个测试通过与否与属性的值是否设置没有关系，即使是只声明了名为$attributeName的属性，这个测试也是通过的，但实例化该类之后var_dump(new ClassAttr()-&gt;attr)的结果却是false。 assetClassHasStaticAttribute($staticAttributeName, $className) 这个自不必多说，和上面类似。只是用来判断静态属性。 对象关系 assertObjectHasAttribute($attributeName, $object) 如果对象$object拥有属性$attributeName，则通过。 包含关系 assertContains($needle, $haystack) 如果$haystack中包含$needle，则通过，否则不通过。这个包含可以是数组的包含，也可以是字符串的包含，注意，默认是区分大小写的，即assertContains('foo', 'FooBar')是不能通过测试的。但assertContains('foo', 'FooBar', '', true)则可以通过测试，也就是说第四个参数表示不区分大小写。至于第三个参数，其实是$message，也就是在测试不通过时报告 详细信息的，我个人理解和try/cache里面的Exception $e里面的getMessage()可能有点类似，没有深究。 assertContainsOnly($type, $array) 如果$array中只包含由$type指定的一种类型的变量，则通过，否则不通过。 assertContainsOnlyInstanceOf($className, $instance_array) 如果$instance_array中的所有元素都是名为$className的类的实例，则通过，否则不通过。 assertInstanceOf($className, $instance) 如果$instance是$className的实例，则通过。 相等相关 是非问题 assertTrue($actual) assertFalse($actual)</div>

  
  <footer>
    <a href="http://unixera.com/php/2015-09-26-PHP%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-02/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      
<nav>
  <ul class="pager">

    
    <li class="disabled"><a href="#">Previous</a></li>
    

    
    <li><a href="http://unixera.com/topics/php/page/2">Next</a></li>
    

  </ul>
</nav>



    </div>
    <div class="col-md-4">
      
<aside class="site">

  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">LatestPosts</h2>
    </div>
    <div class="list-group">
      
      <a href="http://unixera.com/linux/deepin-linux-experience/" class="list-group-item">DeepinLinux体验报告</a>
      
      <a href="http://unixera.com/java/mvn-tutorial-for-novice/" class="list-group-item">给Java新手看的mvn指南</a>
      
      <a href="http://unixera.com/mac/use-ssh-config-to-tune-your-productivity-up/" class="list-group-item">使用ssh-config提升你的生产力</a>
      
      <a href="http://unixera.com/miscs/talk-about-transgene-foods/" class="list-group-item">谈谈转基因食物</a>
      
      <a href="http://unixera.com/php/internals/create-skeleton-of-extension/" class="list-group-item">PHP扩展实战——扩展的骨架</a>
      
      <a href="http://unixera.com/php/internals/class-prototype-in-php/" class="list-group-item">PHP扩展实战——用PHP实现类的原型</a>
      
      <a href="http://unixera.com/php/internals/schedules/" class="list-group-item">PHP扩展实战——目标和计划</a>
      
      <a href="http://unixera.com/php/php-generator-and-iterator/" class="list-group-item">使用PHP生成器和迭代器</a>
      
      <a href="http://unixera.com/php/internals/introduction/" class="list-group-item">PHP扩展实战——背景介绍</a>
      
      <a href="http://unixera.com/php/log-bench/" class="list-group-item">seaslog 和 error_log性能大比拼</a>
      
    </div>
  </div>

  
  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">category</h2>
    </div>
    <div class="list-group">
      
      <a href="http://unixera.com/categories/javascript" class="list-group-item">javascript</a>
      
      <a href="http://unixera.com/categories/php" class="list-group-item">php</a>
      
      <a href="http://unixera.com/categories/miscs" class="list-group-item">miscs</a>
      
      <a href="http://unixera.com/categories/mac" class="list-group-item">mac</a>
      
      <a href="http://unixera.com/categories/linux" class="list-group-item">linux</a>
      
      <a href="http://unixera.com/categories/blog" class="list-group-item">blog</a>
      
      <a href="http://unixera.com/categories/git" class="list-group-item">git</a>
      
      <a href="http://unixera.com/categories/python" class="list-group-item">python</a>
      
      <a href="http://unixera.com/categories/ios" class="list-group-item">ios</a>
      
      <a href="http://unixera.com/categories/mysql" class="list-group-item">mysql</a>
      
    </div>
  </div>
  
  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">tag</h2>
    </div>
    <div class="list-group">
      
      <a href="http://unixera.com/tags/miscs" class="list-group-item">miscs</a>
      
      <a href="http://unixera.com/tags/php" class="list-group-item">php</a>
      
      <a href="http://unixera.com/tags/mac" class="list-group-item">mac</a>
      
      <a href="http://unixera.com/tags/javascript" class="list-group-item">javascript</a>
      
      <a href="http://unixera.com/tags/linux" class="list-group-item">linux</a>
      
      <a href="http://unixera.com/tags/%E6%89%A9%E5%B1%95" class="list-group-item">扩展</a>
      
      <a href="http://unixera.com/tags/git" class="list-group-item">git</a>
      
      <a href="http://unixera.com/tags/bootstrap" class="list-group-item">bootstrap</a>
      
      <a href="http://unixera.com/tags/ios" class="list-group-item">ios</a>
      
      <a href="http://unixera.com/tags/jquery" class="list-group-item">jquery</a>
      
    </div>
  </div>
  
  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">topic</h2>
    </div>
    <div class="list-group">
      
      <a href="http://unixera.com/topics/php" class="list-group-item">php</a>
      
      <a href="http://unixera.com/topics/javascript" class="list-group-item">javascript</a>
      
      <a href="http://unixera.com/topics/linux" class="list-group-item">linux</a>
      
      <a href="http://unixera.com/topics/mac" class="list-group-item">mac</a>
      
      <a href="http://unixera.com/topics/git" class="list-group-item">git</a>
      
      <a href="http://unixera.com/topics/python" class="list-group-item">python</a>
      
      <a href="http://unixera.com/topics/ios" class="list-group-item">ios</a>
      
      <a href="http://unixera.com/topics/mysql" class="list-group-item">mysql</a>
      
      <a href="http://unixera.com/topics/symfony" class="list-group-item">symfony</a>
      
      <a href="http://unixera.com/topics/vim" class="list-group-item">vim</a>
      
    </div>
  </div>
  

</aside>


    </div>
  </div>

</div>
      </div>
    </div>

    <footer class="site">
      <div class="container">
        <p>(c) 2013-2016 Frost Wong. All rights reserved.</p>
        <p>Powered by <a href="http://gohugo.io" target="_blank" rel="nofollow">Hugo</a>, Theme <a href="https://github.com/dim0627/hugo_theme_beg" target="_blank" rel="nofollow">beg</a> designed by <a href="http://yet.unresolved.xyz" target="_blank" rel="nofollow">Daisuke Tsuji</a></p>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery-2.2.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    

  </body>
</html>

